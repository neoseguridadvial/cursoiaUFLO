<!DOCTYPE DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autoevaluaci√≥n de Gesti√≥n de Riesgos Viales - Road Risk Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-bar {
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- Header -->
        <header class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-indigo-900 mb-2">Autoevaluaci√≥n de Gesti√≥n de Riesgos Viales</h1>
            <p class="text-gray-600">Road Risk Toolkit GRSF - Nivel de Unidad Empresarial</p>
        </header>

        <!-- Company Info -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8 fade-in">
            <h2 class="text-xl font-semibold text-indigo-900 mb-4">Informaci√≥n de la Empresa</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="companyName" class="block text-sm font-medium text-gray-700 mb-2">Nombre de la Empresa</label>
                    <input type="text" id="companyName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Ingrese el nombre">
                </div>
                <div>
                    <label for="evaluationDate" class="block text-sm font-medium text-gray-700 mb-2">Fecha de Evaluaci√≥n</label>
                    <input type="date" id="evaluationDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8 rounded-r-lg">
            <h3 class="text-lg font-semibold text-blue-900 mb-3">üìã Instrucciones de Evaluaci√≥n</h3>
            <div class="space-y-2 text-sm text-blue-800">
                <p><strong>Niveles de Autoevaluaci√≥n:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Alto (1 punto):</strong> Todo lo incluido en los detalles est√° en su lugar</li>
                    <li><strong>Intermedio (0.5 puntos):</strong> Parte de lo incluido en los detalles est√° en su lugar</li>
                    <li><strong>Bajo (0 puntos):</strong> Poco o nada de los detalles est√° en su lugar</li>
                </ul>
                <p class="mt-3"><strong>Clasificaci√≥n General:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>üü¢ <strong>Buena:</strong> 75-100%</li>
                    <li>üü° <strong>Intermedia:</strong> 25-75%</li>
                    <li>üî¥ <strong>Baja:</strong> 0-25%</li>
                </ul>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-700">Progreso de Evaluaci√≥n</span>
                <span class="text-sm font-medium text-indigo-600" id="progressText">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div id="progressBar" class="progress-bar bg-indigo-600 h-3 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <!-- Evaluation Sections -->
        <div id="evaluationSections" class="space-y-6">
            <!-- Sections will be generated here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="bg-white rounded-lg shadow-lg p-6 mt-8 hidden">
            <h2 class="text-2xl font-bold text-indigo-900 mb-6">üìä Resultados de la Evaluaci√≥n</h2>
            
            <!-- Consolidated Results Summary -->
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg p-6 mb-8 text-white">
                <h3 class="text-xl font-bold mb-4 text-center">üìä Resumen Consolidado de Resultados</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="text-sm opacity-90 mb-1">Puntaje M√°ximo</p>
                        <p class="text-2xl font-bold" id="maxScore">30</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-90 mb-1">Puntaje Obtenido</p>
                        <p class="text-2xl font-bold" id="obtainedScore">0</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-90 mb-1">Valoraci√≥n /10</p>
                        <p class="text-2xl font-bold" id="ratingOutOf10">0.0</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-90 mb-1">Porcentaje</p>
                        <p class="text-2xl font-bold" id="percentageScore">0%</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg p-6 text-white">
                    <p class="text-sm opacity-90 mb-2">Puntuaci√≥n Total</p>
                    <p class="text-4xl font-bold" id="totalScore">0</p>
                    <p class="text-sm opacity-90 mt-2" id="totalPossible">de 30 puntos</p>
                </div>
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white">
                    <p class="text-sm opacity-90 mb-2">Valoraci√≥n</p>
                    <p class="text-4xl font-bold" id="ratingDisplay">0.0/10</p>
                </div>
                <div class="rounded-lg p-6 text-white" id="classificationBox">
                    <p class="text-sm opacity-90 mb-2">Clasificaci√≥n</p>
                    <p class="text-4xl font-bold" id="classification">-</p>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-xl font-semibold text-indigo-900 mb-4">Resultados por Categor√≠a</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div id="categoryResults" class="space-y-4">
                        <!-- Category results will be inserted here -->
                    </div>
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 text-center">üìà Gr√°fico Radar por Categor√≠as</h4>
                        <div class="flex justify-center">
                            <svg id="radarChart" width="350" height="350" viewBox="0 0 350 350">
                                <!-- Radar chart will be drawn here -->
                            </svg>
                        </div>
                        <div class="mt-4 text-center">
                            <div class="flex items-center justify-center space-x-4 text-sm">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-indigo-600 rounded-full mr-2"></div>
                                    <span class="text-gray-600">Puntuaci√≥n Obtenida</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 border-2 border-gray-400 rounded-full mr-2"></div>
                                    <span class="text-gray-600">Puntuaci√≥n M√°xima</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex gap-4">
                <button onclick="generateReport()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    üìÑ Generar Reporte
                </button>
                <button onclick="resetEvaluation()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    üîÑ Nueva Evaluaci√≥n
                </button>
            </div>
        </div>
    </div>

    <!-- Audit Tips Modal -->
    <div id="auditTipsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                <h3 class="text-lg font-bold text-indigo-900">üí° Tips de Auditor√≠a</h3>
                <button onclick="closeAuditTips()" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">
                    √ó
                </button>
            </div>
            
            <div class="p-6">
                <div class="mb-4">
                    <h4 id="modalTopicTitle" class="font-semibold text-gray-800 text-sm mb-2"></h4>
                </div>
                
                <h5 class="font-semibold text-gray-800 mb-4">üîç Evidencias a Buscar por Nivel:</h5>
                
                <div class="space-y-4">
                    <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-400">
                        <div class="flex items-center mb-3">
                            <span class="w-4 h-4 bg-green-500 rounded-full mr-3"></span>
                            <strong class="text-green-800 text-base">üü¢ Alto (1 punto)</strong>
                        </div>
                        <ul class="text-green-700 text-sm ml-7 space-y-2">
                            <li>‚Ä¢ <strong>Documentaci√≥n completa y actualizada:</strong> Pol√≠ticas, procedimientos y manuales vigentes</li>
                            <li>‚Ä¢ <strong>Procesos implementados y funcionando:</strong> Evidencia de aplicaci√≥n pr√°ctica</li>
                            <li>‚Ä¢ <strong>Registros de seguimiento y auditor√≠a:</strong> Documentaci√≥n de revisiones peri√≥dicas</li>
                            <li>‚Ä¢ <strong>Personal capacitado y consciente:</strong> Certificados de formaci√≥n y conocimiento demostrado</li>
                            <li>‚Ä¢ <strong>Cumplimiento total:</strong> Todos los elementos requeridos est√°n presentes</li>
                        </ul>
                    </div>
                    
                    <div class="p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
                        <div class="flex items-center mb-3">
                            <span class="w-4 h-4 bg-yellow-500 rounded-full mr-3"></span>
                            <strong class="text-yellow-800 text-base">üü° Intermedio (0.5 puntos)</strong>
                        </div>
                        <ul class="text-yellow-700 text-sm ml-7 space-y-2">
                            <li>‚Ä¢ <strong>Documentaci√≥n parcial:</strong> Algunos documentos desactualizados o incompletos</li>
                            <li>‚Ä¢ <strong>Implementaci√≥n en progreso:</strong> Procesos en desarrollo o aplicaci√≥n parcial</li>
                            <li>‚Ä¢ <strong>Registros limitados:</strong> Algunos registros disponibles pero no sistem√°ticos</li>
                            <li>‚Ä¢ <strong>Capacitaci√≥n b√°sica:</strong> Formaci√≥n limitada o no actualizada del personal</li>
                            <li>‚Ä¢ <strong>Cumplimiento parcial:</strong> Aproximadamente 50% de los elementos presentes</li>
                        </ul>
                    </div>
                    
                    <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-400">
                        <div class="flex items-center mb-3">
                            <span class="w-4 h-4 bg-red-500 rounded-full mr-3"></span>
                            <strong class="text-red-800 text-base">üî¥ Bajo (0 puntos)</strong>
                        </div>
                        <ul class="text-red-700 text-sm ml-7 space-y-2">
                            <li>‚Ä¢ <strong>Sin documentaci√≥n:</strong> Ausencia de pol√≠ticas o procedimientos formales</li>
                            <li>‚Ä¢ <strong>Procesos inexistentes:</strong> No hay evidencia de implementaci√≥n</li>
                            <li>‚Ä¢ <strong>Falta de registros:</strong> Sin documentaci√≥n de seguimiento o control</li>
                            <li>‚Ä¢ <strong>Personal sin capacitaci√≥n:</strong> Ausencia de formaci√≥n espec√≠fica</li>
                            <li>‚Ä¢ <strong>Incumplimiento:</strong> Menos del 25% de los elementos requeridos</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <strong class="text-blue-800 text-base block mb-3">üìã Preguntas Clave para el Auditor:</strong>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <ul class="text-blue-700 text-sm space-y-2">
                            <li>‚Ä¢ ¬øExiste evidencia documental verificable?</li>
                            <li>‚Ä¢ ¬øEl personal conoce y aplica los procedimientos?</li>
                            <li>‚Ä¢ ¬øSe realizan revisiones y actualizaciones peri√≥dicas?</li>
                            <li>‚Ä¢ ¬øHay registros que demuestren el cumplimiento?</li>
                        </ul>
                        <ul class="text-blue-700 text-sm space-y-2">
                            <li>‚Ä¢ ¬øLos procesos est√°n formalmente establecidos?</li>
                            <li>‚Ä¢ ¬øExiste supervisi√≥n y control efectivo?</li>
                            <li>‚Ä¢ ¬øSe documentan las no conformidades?</li>
                            <li>‚Ä¢ ¬øHay evidencia de mejora continua?</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <strong class="text-gray-800 text-base block mb-3">üìù M√©todos de Verificaci√≥n Recomendados:</strong>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <h6 class="font-semibold text-gray-700 mb-2">üìÑ Revisi√≥n Documental</h6>
                            <ul class="text-gray-600 text-sm space-y-1">
                                <li>‚Ä¢ Pol√≠ticas y procedimientos</li>
                                <li>‚Ä¢ Registros de capacitaci√≥n</li>
                                <li>‚Ä¢ Informes de auditor√≠a</li>
                                <li>‚Ä¢ Certificaciones</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-semibold text-gray-700 mb-2">üë• Entrevistas</h6>
                            <ul class="text-gray-600 text-sm space-y-1">
                                <li>‚Ä¢ Personal operativo</li>
                                <li>‚Ä¢ Supervisores</li>
                                <li>‚Ä¢ Gerentes</li>
                                <li>‚Ä¢ Conductores</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-semibold text-gray-700 mb-2">üëÅÔ∏è Observaci√≥n Directa</h6>
                            <ul class="text-gray-600 text-sm space-y-1">
                                <li>‚Ä¢ Pr√°cticas en campo</li>
                                <li>‚Ä¢ Condiciones de veh√≠culos</li>
                                <li>‚Ä¢ Comportamientos</li>
                                <li>‚Ä¢ Instalaciones</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sticky bottom-0 bg-gray-50 px-6 py-4 border-t border-gray-200">
                <button onclick="closeAuditTips()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <script>
        const evaluationData = {
            "Gesti√≥n": [
                {
                    tema: "Gesti√≥n Financiera - Coste Total del Riesgo",
                    detalle: "El Coste Total del Riesgo, incluidas TODAS las p√©rdidas no aseguradas / costes ocultos, se conoce y comprende en toda la organizaci√≥n, y tambi√©n se entiende en relaci√≥n con la forma en que los ingresos necesarios para financiar el Coste Total del Riesgo se relacionan con el producto o servicio principal."
                },
                {
                    tema: "Gesti√≥n Financiera - Presupuesto de Gesti√≥n de Riesgos",
                    detalle: "El programa de gesti√≥n del riesgo vial relacionado con el trabajo tiene un presupuesto separado, suficiente para las acciones acordadas, limitado y revisado al menos anualmente en funci√≥n de la evoluci√≥n de la estrategia y el programa."
                },
                {
                    tema: "Conflictos Operacionales - Alineaci√≥n de pr√°cticas",
                    detalle: "Las pol√≠ticas, procedimientos y pr√°cticas operacionales est√°n totalmente alineados con los requisitos de conducci√≥n segura y las pol√≠ticas de conducci√≥n segura de la organizaci√≥n. Cualquier cambio en las operaciones, incluidas las adquisiciones, tiene en cuenta los requisitos de conducci√≥n segura antes de llevarse a cabo."
                },
                {
                    tema: "Supervisi√≥n del Conductor - Seguimiento",
                    detalle: "Todos los conductores, incluidos los conductores de la Flota Gris, son supervisados de manera rutinaria y transparente mediante el uso de datos de telemetr√≠a, unidades acompa√±adas, informes p√∫blicos de mala conducci√≥n observada, an√°lisis de registros (combustible, mantenimiento, tel√©fono m√≥vil) seg√∫n corresponda."
                }
            ],
            "Pol√≠ticas y Procedimientos": [
                {
                    tema: "Conducci√≥n en el Trabajo - Pol√≠tica de gesti√≥n",
                    detalle: "Existe una pol√≠tica integral, revisada y actualizada anualmente."
                },
                {
                    tema: "Conducci√≥n en el Trabajo - Legislaci√≥n",
                    detalle: "La pol√≠tica cumple totalmente con la legislaci√≥n local, en todas las √°reas de operaci√≥n, y establece claramente las expectativas con las que debe cumplir el empleado."
                },
                {
                    tema: "Pol√≠tica de Conducci√≥n Distra√≠da - Tel√©fonos m√≥viles",
                    detalle: "No se permite el uso de tel√©fonos m√≥viles mientras se conduce, incluido el sistema de manos libres, y se realiza una revisi√≥n para verificar el cumplimiento. Los conductores nunca deben usar su smartphone para otra cosa que no sea navegaci√≥n (si est√° permitido en la pol√≠tica) mientras conducen."
                },
                {
                    tema: "Pol√≠tica de Conducci√≥n Distra√≠da - Otras distracciones",
                    detalle: "El uso de cualquier material potencialmente distractor no est√° permitido mientras se conduce, con revisiones para verificar el cumplimiento."
                },
                {
                    tema: "Pol√≠tica de Gesti√≥n del Cansancio - Horas de trabajo",
                    detalle: "Existe una pol√≠tica que limita la duraci√≥n total de la jornada laboral, incluida la conducci√≥n y los desplazamientos, con una auditor√≠a de seguimiento para demostrar el cumplimiento."
                },
                {
                    tema: "Pol√≠tica de Alcohol y Drogas",
                    detalle: "Existe una pol√≠tica clara sobre consumo de alcohol y drogas, con procedimientos de verificaci√≥n y cumplimiento establecidos."
                },
                {
                    tema: "Problemas de Vista - Examinaci√≥n de la vista",
                    detalle: "Todos los empleados que realizan viajes por carretera relacionados con el trabajo, incluidos los conductores de la Flota Gris, reciben pruebas de visi√≥n al menos una vez cada 2 a√±os, con una auditor√≠a de seguimiento."
                },
                {
                    tema: "Gesti√≥n de la Velocidad - Exceso de velocidad",
                    detalle: "Existe una pol√≠tica formal sobre la conducci√≥n dentro de los l√≠mites de velocidad y a una velocidad adecuada para las condiciones prevalecientes de la carretera (p. ej. en condiciones clim√°ticas adversas), con una auditor√≠a de seguimiento que cubre a todos los empleados, incluidos los conductores de la Flota Gris."
                },
                {
                    tema: "Gesti√≥n de Pol√≠tica - Revisiones y actualizaciones",
                    detalle: "Las pol√≠ticas se revisan y actualizan anualmente para tener en cuenta los cambios en las pr√°cticas operativas, la gesti√≥n de la seguridad vial, los cambios en la legislaci√≥n y las iniciativas de mejora continua."
                },
                {
                    tema: "Gesti√≥n de la Flota Gris - Objetivo",
                    detalle: "O hay empleados que NUNCA viajan en veh√≠culos que no sean propiedad o est√©n administrados por la empresa o TODOS los empleados que VIAJEN por carretera por objetivos de trabajo est√°n sujetos a la pol√≠tica."
                },
                {
                    tema: "Revisi√≥n - Auditor√≠a de seguimiento",
                    detalle: "Existe una auditor√≠a de seguimiento para TODAS las pol√≠ticas para demostrar que se est√°n siguiendo y que son efectivas."
                }
            ],
            "Evaluar": [
                {
                    tema: "Evaluaci√≥n de riesgos - Para todos los conductores",
                    detalle: "Se eval√∫an los riesgos para todos los conductores que conduzcan alguna vez por motivos de trabajo, incluyendo a los conductores de flota gris."
                },
                {
                    tema: "Verificaciones del Permiso de Conducir - Todos los permisos",
                    detalle: "Se verifican los permisos de conducir de todos los conductores, incluidos los conductores de veh√≠culos de la Flota Gris, para asegurarse de que est√°n en vigor y son v√°lidos mientras se conduce el veh√≠culo."
                }
            ],
            "Control": [
                {
                    tema: "Intervenciones del Conductor - ¬øQu√© intervenciones existen?",
                    detalle: "Una combinaci√≥n de: en el veh√≠culo, en el aula y en l√≠nea, en funci√≥n de la necesidad identificada por los datos de evaluaci√≥n (evaluaciones de riesgos, informes de colisi√≥n, datos de telemetr√≠a de comportamiento del conductor y verificaciones de permisos conducir)."
                }
            ],
            "Medida": [
                {
                    tema: "Gesti√≥n de accidentes - Costes directos",
                    detalle: "Todos los interesados conocen y entienden todos los costes de seguro, y cualquier coste por debajo del deducible (por debajo del exceso de seguro) asociados con incidentes de conducci√≥n. Esto ayuda a garantizar que todos entiendan las implicaciones completas para el negocio de un accidente."
                },
                {
                    tema: "Indicadores Clave de Rendimiento - Indicadores rezagados",
                    detalle: "Los indicadores rezagados, incluidos los accidentes por mill√≥n de millas (CPMM), los costes de accidentes, el coste de mantenimiento y la cantidad de infracciones de conducci√≥n, son conocidos por todos los conductores, incluidos los empleados que conducen veh√≠culos de la Flota Gris, se registran mensualmente y son conocidos y entendidos por todos los interesados."
                },
                {
                    tema: "Informes de Accidentes - Informe del conductor",
                    detalle: "El conductor registra los datos completos, incluyendo fotograf√≠as, para cada incidente e informa a las aseguradoras inmediatamente y al Superiores Inmediato en 24 horas."
                },
                {
                    tema: "Informes de Accidentes - Fichas de accidentes",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh√≠culos de la Flota Gris, tienen una ficha de accidentes completa o equivalente, que cubre todos los detalles que ser√°n √∫tiles en el an√°lisis posterior de la causa ra√≠z, as√≠ como lo requieren las aseguradoras, para permitir que todos los detalles del incidente se registren de forma sistem√°tica. Hay evidencia de que estas se completan en su totalidad despu√©s de cada incidente."
                },
                {
                    tema: "Informes de Gesti√≥n - Visibilidad para la alta gerencia",
                    detalle: "Todos los Indicadores Clave de Rendimiento del programa de gesti√≥n de riesgos viales relacionados con el trabajo se distribuyen a todos los gerentes principales al menos mensualmente."
                }
            ],
            "Conductor": [
                {
                    tema: "Manual del Conductor - Manuales suministrados",
                    detalle: "Se proporcionan manuales para conductores a TODOS los empleados que realizan viajes por carretera relacionados con el trabajo, incluidos los empleados que conducen veh√≠culos de la Flota Gris, que incluyen todos los elementos clave de pol√≠ticas y procedimientos junto con consejos de conducci√≥n segura. El manual debe ayudar a los empleados a cumplir con sus pol√≠ticas y procedimientos de conducci√≥n segura."
                },
                {
                    tema: "Manual del Conductor - Revisi√≥n y actualizaci√≥n",
                    detalle: "Los manuales se revisan anualmente y/o cada vez que se realizan cambios significativos en las pol√≠ticas y procedimientos o consejos de seguridad de conducci√≥n y se actualizan en consecuencia."
                },
                {
                    tema: "Responsabilidades del Conductor - Condiciones para conducir",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh√≠culos de la Flota Gris, se aseguran de que est√©n en condiciones de conducir antes de realizar CUALQUIER viaje por carretera relacionado con el trabajo. Esto incluye cuestiones relacionadas con la salud, la vista, la discapacidad y la fatiga."
                },
                {
                    tema: "Responsabilidades del Conductor - Cumplimiento legislativo",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh√≠culos de la Flota Gris, cumplen plenamente con toda la legislaci√≥n local. Hay una auditor√≠a de seguimiento que demuestra que la mayor√≠a de los conductores cumplen con esta obligaci√≥n (p. ej. por multas por exceso de velocidad)."
                },
                {
                    tema: "Responsabilidades del Conductor - Notificaci√≥n de cambios",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh√≠culos de la Flota Gris, est√°n totalmente obligados a notificar a su Superior Inmediato sobre cualquier cambio en las circunstancias que podr√≠an cambiar los riesgos que enfrentan. Esto incluye problemas de salud, cambios de direcci√≥n y cambios en los permisos de conducir."
                },
                {
                    tema: "Responsabilidades del Conductor - Legalidad del veh√≠culo",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh√≠culos de la Flota Gris, son plenamente conscientes de su obligaci√≥n de garantizar que el veh√≠culo que utilizan para viajes por carretera relacionados con el trabajo, independientemente de su propiedad, sea completamente legal y cumpla con los requisitos m√≠nimos de seguridad de la empresa. Existen pruebas de que esta obligaci√≥n generalmente se cumple (p. ej. de los registros de mantenimiento, como los veh√≠culos que tienen uno o m√°s neum√°ticos defectuosos)."
                }
            ],
            "Viaje": [
                {
                    tema: "Evaluaci√≥n de la necesidad de viajar - Los viajes innecesarios son eliminados",
                    detalle: "Los viajes se eliminan siempre que sea posible, a trav√©s de cambios en las pr√°cticas operativas (p. ej. mediante el uso de videoconferencia para reemplazar la necesidad de viajar en algunos casos)."
                },
                {
                    tema: "Condiciones Clim√°ticas Adversas - Conducci√≥n en climas extremos",
                    detalle: "No se realizan viajes en condiciones clim√°ticas extremas, donde las autoridades han aconsejado no viajar o donde su evaluaci√≥n din√°mica de riesgos muestra que existen riesgos inaceptables."
                }
            ],
            "Veh√≠culo": [
                {
                    tema: "Selecci√≥n del Veh√≠culo - Los veh√≠culos se adecuan al prop√≥sito",
                    detalle: "Todos los veh√≠culos, incluidos los veh√≠culos de la Flota Gris, son adecuados para los viajes requeridos (adecuados para el prop√≥sito). Esto incluye problemas ergon√≥micos en torno a las posiciones de los asientos, lo que se transporta en el veh√≠culo y la carga/descarga."
                },
                {
                    tema: "Selecci√≥n del Veh√≠culo - Especificaci√≥n de seguridad m√≠nima",
                    detalle: "Todos los veh√≠culos est√°n equipados con cinturones de seguridad para todos los asientos, 2 espejos retrovisores, 2 airbags y Control Electr√≥nico de Estabilidad como m√≠nimo. Si su especificaci√≥n de seguridad m√≠nima es m√°s avanzada, entonces deber√≠a usarse como estos criterios."
                },
                {
                    tema: "Mantenimiento del Veh√≠culo - Mantenimiento de rutina",
                    detalle: "Todos los conductores revisan sus veh√≠culos al menos una vez por semana, con evidencia como soporte. Para furgonetas y camiones, estos controles se llevan a cabo diariamente. Existe una auditor√≠a de seguimiento para apoyar esto."
                },
                {
                    tema: "Mantenimiento del Veh√≠culo - Reparaci√≥n",
                    detalle: "Todos los veh√≠culos, incluidos los veh√≠culos de la Flota Gris, son verificados seg√∫n los programas del fabricante y/o intervalos variables, por talleres OEM [Original Equipment Manufacturer (Fabricante de Equipo Original)]. Existe una auditor√≠a de seguimiento para apoyar esto."
                }
            ]
        };

        let responses = {};
        let totalQuestions = 0;

        function initializeEvaluation() {
            const container = document.getElementById('evaluationSections');
            let questionId = 0;

            Object.keys(evaluationData).forEach((category, categoryIndex) => {
                const section = document.createElement('div');
                section.className = 'bg-white rounded-lg shadow-lg fade-in';
                
                let sectionHTML = `
                    <div class="p-6 border-b border-gray-200">
                        <button onclick="toggleSection('${category}')" class="w-full flex items-center justify-between text-left">
                            <h2 class="text-2xl font-bold text-indigo-900">
                                ${category} (${evaluationData[category].length} preguntas)
                            </h2>
                            <svg id="icon-${category}" class="w-6 h-6 text-indigo-600 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="content-${category}" class="p-6 ${categoryIndex === 0 ? '' : 'hidden'}">
                `;

                // Create table structure
                sectionHTML += `
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse bg-white rounded-lg shadow-sm">
                            <thead>
                                <tr class="bg-indigo-50">
                                    <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-indigo-900 w-1/3">Tema</th>
                                    <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-indigo-900 w-1/2">Detalle</th>
                                    <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-indigo-900 w-1/6">Evaluaci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                evaluationData[category].forEach((item, itemIndex) => {
                    const id = `q${questionId}`;
                    totalQuestions++;
                    
                    sectionHTML += `
                        <tr class="${itemIndex % 2 === 0 ? 'bg-gray-50' : 'bg-white'} hover:bg-blue-50 transition duration-200">
                            <td class="border border-gray-300 px-4 py-4 align-top">
                                <h4 class="font-semibold text-gray-800 text-sm leading-tight">${item.tema}</h4>
                            </td>
                            <td class="border border-gray-300 px-4 py-4 align-top">
                                <p class="text-xs text-gray-600 leading-relaxed">${item.detalle}</p>
                            </td>
                            <td class="border border-gray-300 px-4 py-4 align-top">
                                <div class="relative">
                                    <select name="${id}" onchange="updateResponse('${id}', parseFloat(this.value), '${category}')" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent appearance-none bg-white cursor-pointer">
                                        <option value="" class="text-gray-500">Seleccionar...</option>
                                        <option value="1" class="text-green-700 font-medium">üü¢ Alto (1 punto)</option>
                                        <option value="0.5" class="text-yellow-700 font-medium">üü° Intermedio (0.5 puntos)</option>
                                        <option value="0" class="text-red-700 font-medium">üî¥ Bajo (0 puntos)</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </div>
                                
                                <!-- Audit Tips Button -->
                                <button type="button" onclick="showAuditTips('${item.tema}')" class="mt-2 w-full text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 px-2 py-1 rounded border border-blue-200 transition duration-200">
                                    üí° Ver Tips de Auditor√≠a
                                </button>
                            </td>
                        </tr>
                    `;
                    
                    questionId++;
                });

                sectionHTML += `
                            </tbody>
                        </table>
                    </div>
                `;

                sectionHTML += '</div>';
                section.innerHTML = sectionHTML;
                container.appendChild(section);
            });

            document.getElementById('evaluationDate').valueAsDate = new Date();
        }

        function toggleSection(category) {
            const content = document.getElementById(`content-${category}`);
            const icon = document.getElementById(`icon-${category}`);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function updateResponse(questionId, score, category) {
            responses[questionId] = { score, category };
            updateProgress();
            checkCompletion();
        }

        function updateProgress() {
            const answered = Object.keys(responses).length;
            const percentage = Math.round((answered / totalQuestions) * 100);
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';
        }

        function checkCompletion() {
            if (Object.keys(responses).length === totalQuestions) {
                calculateResults();
            }
        }

        function calculateResults() {
            let totalScore = 0;
            const categoryScores = {};

            Object.values(responses).forEach(response => {
                totalScore += response.score;
                
                if (!categoryScores[response.category]) {
                    categoryScores[response.category] = { score: 0, count: 0 };
                }
                categoryScores[response.category].score += response.score;
                categoryScores[response.category].count += 1;
            });

            const percentage = (totalScore / totalQuestions) * 100;
            let classification, classColor;

            if (percentage >= 75) {
                classification = "Buena";
                classColor = "from-green-500 to-green-600";
            } else if (percentage >= 25) {
                classification = "Intermedia";
                classColor = "from-yellow-500 to-yellow-600";
            } else {
                classification = "Baja";
                classColor = "from-red-500 to-red-600";
            }

            // Calculate rating out of 10
            const ratingOutOf10 = (percentage / 100) * 10;
            
            // Update all display elements
            document.getElementById('maxScore').textContent = totalQuestions;
            document.getElementById('obtainedScore').textContent = totalScore.toFixed(1);
            document.getElementById('ratingOutOf10').textContent = ratingOutOf10.toFixed(1);
            document.getElementById('totalScore').textContent = totalScore.toFixed(1);
            document.getElementById('totalPossible').textContent = `de ${totalQuestions} puntos`;
            document.getElementById('percentageScore').textContent = percentage.toFixed(1) + '%';
            document.getElementById('ratingDisplay').textContent = ratingOutOf10.toFixed(1) + '/10';
            document.getElementById('classification').textContent = classification;
            document.getElementById('classificationBox').className = `rounded-lg p-6 text-white bg-gradient-to-br ${classColor}`;

            const categoryResultsHTML = Object.keys(categoryScores).map(category => {
                const catScore = categoryScores[category].score;
                const catMax = categoryScores[category].count;
                const catPercentage = (catScore / catMax) * 100;
                
                return `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-gray-800">${category}</h4>
                            <span class="text-sm font-medium text-indigo-600">${catScore.toFixed(1)} / ${catMax}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: ${catPercentage}%"></div>
                        </div>
                        <p class="text-xs text-gray-600 mt-1">${catPercentage.toFixed(1)}%</p>
                    </div>
                `;
            }).join('');

            document.getElementById('categoryResults').innerHTML = categoryResultsHTML;
            createRadarChart(categoryScores);
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateReport() {
            const companyName = document.getElementById('companyName').value || 'Sin especificar';
            const evaluationDate = document.getElementById('evaluationDate').value || new Date().toISOString().split('T')[0];
            
            let totalScore = 0;
            Object.values(responses).forEach(response => {
                totalScore += response.score;
            });
            const percentage = (totalScore / totalQuestions) * 100;
            
            let classification;
            if (percentage >= 75) classification = "Buena";
            else if (percentage >= 25) classification = "Intermedia";
            else classification = "Baja";

            let reportContent = `REPORTE DE AUTOEVALUACI√ìN DE GESTI√ìN DE RIESGOS VIALES\n`;
            reportContent += `Road Risk Toolkit GRSF\n`;
            reportContent += `${'='.repeat(60)}\n\n`;
            reportContent += `Empresa: ${companyName}\n`;
            reportContent += `Fecha de Evaluaci√≥n: ${evaluationDate}\n\n`;
            reportContent += `RESULTADOS GENERALES\n`;
            reportContent += `${'-'.repeat(60)}\n`;
            reportContent += `Puntuaci√≥n Total: ${totalScore.toFixed(1)} de ${totalQuestions} puntos\n`;
            reportContent += `Porcentaje: ${percentage.toFixed(1)}%\n`;
            reportContent += `Clasificaci√≥n: ${classification}\n\n`;
            
            reportContent += `DETALLES POR CATEGOR√çA\n`;
            reportContent += `${'-'.repeat(60)}\n\n`;

            const categoryScores = {};
            Object.values(responses).forEach(response => {
                if (!categoryScores[response.category]) {
                    categoryScores[response.category] = { score: 0, count: 0 };
                }
                categoryScores[response.category].score += response.score;
                categoryScores[response.category].count += 1;
            });

            Object.keys(categoryScores).forEach(category => {
                const catScore = categoryScores[category].score;
                const catMax = categoryScores[category].count;
                const catPercentage = (catScore / catMax) * 100;
                reportContent += `${category}:\n`;
                reportContent += `  Puntuaci√≥n: ${catScore.toFixed(1)} / ${catMax}\n`;
                reportContent += `  Porcentaje: ${catPercentage.toFixed(1)}%\n\n`;
            });

            reportContent += `\n${'='.repeat(60)}\n`;
            reportContent += `Generado por Road Risk Toolkit - Autoevaluaci√≥n\n`;
            reportContent += `Para m√°s informaci√≥n: https://roadrisktoolkit.com/\n`;

            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Reporte_Evaluacion_${companyName.replace(/\s+/g, '_')}_${evaluationDate}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function createRadarChart(categoryScores) {
            const svg = document.getElementById('radarChart');
            svg.innerHTML = '';
            
            const centerX = 175;
            const centerY = 175;
            const maxRadius = 130;
            const categories = Object.keys(categoryScores);
            const numCategories = categories.length;
            
            // Create background circles with labels
            for (let i = 1; i <= 5; i++) {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', centerX);
                circle.setAttribute('cy', centerY);
                circle.setAttribute('r', (maxRadius * i) / 5);
                circle.setAttribute('fill', 'none');
                circle.setAttribute('stroke', i === 5 ? '#9ca3af' : '#e5e7eb');
                circle.setAttribute('stroke-width', i === 5 ? '2' : '1');
                svg.appendChild(circle);
                
                // Add percentage labels
                if (i === 5) {
                    const percentages = [20, 40, 60, 80, 100];
                    percentages.forEach((perc, idx) => {
                        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        text.setAttribute('x', centerX + 5);
                        text.setAttribute('y', centerY - (maxRadius * (idx + 1)) / 5 + 4);
                        text.setAttribute('font-size', '10');
                        text.setAttribute('fill', '#6b7280');
                        text.textContent = perc + '%';
                        svg.appendChild(text);
                    });
                }
            }
            
            // Create axis lines and labels
            categories.forEach((category, index) => {
                const angle = (index * 2 * Math.PI) / numCategories - Math.PI / 2;
                const x = centerX + Math.cos(angle) * maxRadius;
                const y = centerY + Math.sin(angle) * maxRadius;
                
                // Axis line
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', centerX);
                line.setAttribute('y1', centerY);
                line.setAttribute('x2', x);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#9ca3af');
                line.setAttribute('stroke-width', '2');
                svg.appendChild(line);
                
                // Label with better positioning
                const labelDistance = maxRadius + 35;
                const labelX = centerX + Math.cos(angle) * labelDistance;
                const labelY = centerY + Math.sin(angle) * labelDistance;
                
                // Create text with line breaks for long category names
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', labelX);
                text.setAttribute('y', labelY);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('font-size', '11');
                text.setAttribute('font-weight', 'bold');
                text.setAttribute('fill', '#1f2937');
                
                // Split long category names
                const words = category.split(' ');
                if (words.length > 2) {
                    const tspan1 = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                    tspan1.setAttribute('x', labelX);
                    tspan1.setAttribute('dy', '-6');
                    tspan1.textContent = words.slice(0, 2).join(' ');
                    text.appendChild(tspan1);
                    
                    const tspan2 = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                    tspan2.setAttribute('x', labelX);
                    tspan2.setAttribute('dy', '12');
                    tspan2.textContent = words.slice(2).join(' ');
                    text.appendChild(tspan2);
                } else {
                    text.textContent = category;
                }
                
                svg.appendChild(text);
            });
            
            // Create data polygon
            let pathData = '';
            const dataPoints = [];
            
            categories.forEach((category, index) => {
                const score = categoryScores[category].score;
                const maxScore = categoryScores[category].count;
                const percentage = (score / maxScore) * 100;
                const radius = (maxRadius * percentage) / 100;
                
                const angle = (index * 2 * Math.PI) / numCategories - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                dataPoints.push({ x, y, percentage: percentage.toFixed(1), category });
                
                if (index === 0) {
                    pathData += `M ${x} ${y}`;
                } else {
                    pathData += ` L ${x} ${y}`;
                }
            });
            
            pathData += ' Z';
            
            // Add filled polygon
            const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            polygon.setAttribute('d', pathData);
            polygon.setAttribute('fill', 'rgba(79, 70, 229, 0.3)');
            polygon.setAttribute('stroke', '#4f46e5');
            polygon.setAttribute('stroke-width', '3');
            svg.appendChild(polygon);
            
            // Add data points with values
            dataPoints.forEach(point => {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', point.x);
                circle.setAttribute('cy', point.y);
                circle.setAttribute('r', '5');
                circle.setAttribute('fill', '#4f46e5');
                circle.setAttribute('stroke', 'white');
                circle.setAttribute('stroke-width', '2');
                svg.appendChild(circle);
                
                // Add percentage value near the point
                const valueText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                valueText.setAttribute('x', point.x);
                valueText.setAttribute('y', point.y - 10);
                valueText.setAttribute('text-anchor', 'middle');
                valueText.setAttribute('font-size', '10');
                valueText.setAttribute('font-weight', 'bold');
                valueText.setAttribute('fill', '#1f2937');
                valueText.setAttribute('background', 'white');
                valueText.textContent = point.percentage + '%';
                svg.appendChild(valueText);
            });
        }

        function showAuditTips(topicTitle) {
            document.getElementById('modalTopicTitle').textContent = topicTitle;
            document.getElementById('auditTipsModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeAuditTips() {
            document.getElementById('auditTipsModal').classList.add('hidden');
            document.body.style.overflow = 'auto'; // Restore scrolling
        }

        // Close modal when clicking outside
        document.getElementById('auditTipsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAuditTips();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !document.getElementById('auditTipsModal').classList.contains('hidden')) {
                closeAuditTips();
            }
        });

        function resetEvaluation() {
            responses = {};
            document.getElementById('companyName').value = '';
            document.getElementById('evaluationDate').valueAsDate = new Date();
            
            const selects = document.querySelectorAll('select[name^="q"]');
            selects.forEach(select => select.value = '');
            
            // Close any open modal
            closeAuditTips();
            
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
            document.getElementById('resultsSection').classList.add('hidden');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        initializeEvaluation();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9966788c93f8b6ec',t:'MTc2MTc4MDczMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
