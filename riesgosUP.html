<!DOCTYPE DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autoevaluaci칩n de Gesti칩n de Riesgos Viales - Road Risk Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-bar {
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- Header -->
        <header class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-indigo-900 mb-2">Autoevaluaci칩n de Gesti칩n de Riesgos Viales</h1>
            <p class="text-gray-600">Road Risk Toolkit GRSF - Nivel de Unidad Empresarial</p>
        </header>

        <!-- Company Info -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8 fade-in">
            <h2 class="text-xl font-semibold text-indigo-900 mb-4">Informaci칩n de la Empresa</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="companyName" class="block text-sm font-medium text-gray-700 mb-2">Nombre de la Empresa</label>
                    <input type="text" id="companyName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Ingrese el nombre">
                </div>
                <div>
                    <label for="evaluationDate" class="block text-sm font-medium text-gray-700 mb-2">Fecha de Evaluaci칩n</label>
                    <input type="date" id="evaluationDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8 rounded-r-lg">
            <h3 class="text-lg font-semibold text-blue-900 mb-3">游늶 Instrucciones de Evaluaci칩n</h3>
            <div class="space-y-2 text-sm text-blue-800">
                <p><strong>Niveles de Autoevaluaci칩n:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Alto (1 punto):</strong> Todo lo incluido en los detalles est치 en su lugar</li>
                    <li><strong>Intermedio (0.5 puntos):</strong> Parte de lo incluido en los detalles est치 en su lugar</li>
                    <li><strong>Bajo (0 puntos):</strong> Poco o nada de los detalles est치 en su lugar</li>
                </ul>
                <p class="mt-3"><strong>Clasificaci칩n General:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>游릭 <strong>Buena:</strong> 75-100%</li>
                    <li>游리 <strong>Intermedia:</strong> 25-75%</li>
                    <li>游댮 <strong>Baja:</strong> 0-25%</li>
                </ul>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-700">Progreso de Evaluaci칩n</span>
                <span class="text-sm font-medium text-indigo-600" id="progressText">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div id="progressBar" class="progress-bar bg-indigo-600 h-3 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <!-- Evaluation Sections -->
        <div id="evaluationSections" class="space-y-6">
            <!-- Sections will be generated here -->
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="bg-white rounded-lg shadow-lg p-6 mt-8 hidden">
            <h2 class="text-2xl font-bold text-indigo-900 mb-6">游늵 Resultados de la Evaluaci칩n</h2>
            
            <!-- Consolidated Results Summary -->
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg p-6 mb-8 text-white">
                <h3 class="text-xl font-bold mb-4 text-center">游늵 Resumen Consolidado de Resultados</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="text-sm opacity-90 mb-1">Puntaje M치ximo</p>
                        <p class="text-2xl font-bold" id="maxScore">30</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-90 mb-1">Puntaje Obtenido</p>
                        <p class="text-2xl font-bold" id="obtainedScore">0</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-90 mb-1">Valoraci칩n /10</p>
                        <p class="text-2xl font-bold" id="ratingOutOf10">0.0</p>
                    </div>
                    <div>
                        <p class="text-sm opacity-90 mb-1">Porcentaje</p>
                        <p class="text-2xl font-bold" id="percentageScore">0%</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg p-6 text-white">
                    <p class="text-sm opacity-90 mb-2">Puntuaci칩n Total</p>
                    <p class="text-4xl font-bold" id="totalScore">0</p>
                    <p class="text-sm opacity-90 mt-2" id="totalPossible">de 30 puntos</p>
                </div>
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white">
                    <p class="text-sm opacity-90 mb-2">Valoraci칩n</p>
                    <p class="text-4xl font-bold" id="ratingDisplay">0.0/10</p>
                </div>
                <div class="rounded-lg p-6 text-white" id="classificationBox">
                    <p class="text-sm opacity-90 mb-2">Clasificaci칩n</p>
                    <p class="text-4xl font-bold" id="classification">-</p>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-xl font-semibold text-indigo-900 mb-4">Resultados por Categor칤a</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div id="categoryResults" class="space-y-4">
                        <!-- Category results will be inserted here -->
                    </div>
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 text-center">游늳 Gr치fico Radar por Categor칤as</h4>
                        <div class="flex justify-center">
                            <svg id="radarChart" width="350" height="350" viewBox="0 0 350 350">
                                <!-- Radar chart will be drawn here -->
                            </svg>
                        </div>
                        <div class="mt-4 text-center">
                            <div class="flex items-center justify-center space-x-4 text-sm">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-indigo-600 rounded-full mr-2"></div>
                                    <span class="text-gray-600">Puntuaci칩n Obtenida</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 border-2 border-gray-400 rounded-full mr-2"></div>
                                    <span class="text-gray-600">Puntuaci칩n M치xima</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex gap-4">
                <button onclick="generateReport()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    游늯 Generar Reporte
                </button>
                <button onclick="resetEvaluation()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    游댃 Nueva Evaluaci칩n
                </button>
            </div>
        </div>
    </div>

    <script>
        const evaluationData = {
            "Gesti칩n": [
                {
                    tema: "Gesti칩n Financiera - Coste Total del Riesgo",
                    detalle: "El Coste Total del Riesgo, incluidas TODAS las p칠rdidas no aseguradas / costes ocultos, se conoce y comprende en toda la organizaci칩n, y tambi칠n se entiende en relaci칩n con la forma en que los ingresos necesarios para financiar el Coste Total del Riesgo se relacionan con el producto o servicio principal."
                },
                {
                    tema: "Gesti칩n Financiera - Presupuesto de Gesti칩n de Riesgos",
                    detalle: "El programa de gesti칩n del riesgo vial relacionado con el trabajo tiene un presupuesto separado, suficiente para las acciones acordadas, limitado y revisado al menos anualmente en funci칩n de la evoluci칩n de la estrategia y el programa."
                },
                {
                    tema: "Conflictos Operacionales - Alineaci칩n de pr치cticas",
                    detalle: "Las pol칤ticas, procedimientos y pr치cticas operacionales est치n totalmente alineados con los requisitos de conducci칩n segura y las pol칤ticas de conducci칩n segura de la organizaci칩n. Cualquier cambio en las operaciones, incluidas las adquisiciones, tiene en cuenta los requisitos de conducci칩n segura antes de llevarse a cabo."
                },
                {
                    tema: "Supervisi칩n del Conductor - Seguimiento",
                    detalle: "Todos los conductores, incluidos los conductores de la Flota Gris, son supervisados de manera rutinaria y transparente mediante el uso de datos de telemetr칤a, unidades acompa침adas, informes p칰blicos de mala conducci칩n observada, an치lisis de registros (combustible, mantenimiento, tel칠fono m칩vil) seg칰n corresponda."
                }
            ],
            "Pol칤ticas y Procedimientos": [
                {
                    tema: "Conducci칩n en el Trabajo - Pol칤tica de gesti칩n",
                    detalle: "Existe una pol칤tica integral, revisada y actualizada anualmente."
                },
                {
                    tema: "Conducci칩n en el Trabajo - Legislaci칩n",
                    detalle: "La pol칤tica cumple totalmente con la legislaci칩n local, en todas las 치reas de operaci칩n, y establece claramente las expectativas con las que debe cumplir el empleado."
                },
                {
                    tema: "Pol칤tica de Conducci칩n Distra칤da - Tel칠fonos m칩viles",
                    detalle: "No se permite el uso de tel칠fonos m칩viles mientras se conduce, incluido el sistema de manos libres, y se realiza una revisi칩n para verificar el cumplimiento. Los conductores nunca deben usar su smartphone para otra cosa que no sea navegaci칩n (si est치 permitido en la pol칤tica) mientras conducen."
                },
                {
                    tema: "Pol칤tica de Conducci칩n Distra칤da - Otras distracciones",
                    detalle: "El uso de cualquier material potencialmente distractor no est치 permitido mientras se conduce, con revisiones para verificar el cumplimiento."
                },
                {
                    tema: "Pol칤tica de Gesti칩n del Cansancio - Horas de trabajo",
                    detalle: "Existe una pol칤tica que limita la duraci칩n total de la jornada laboral, incluida la conducci칩n y los desplazamientos, con una auditor칤a de seguimiento para demostrar el cumplimiento."
                },
                {
                    tema: "Pol칤tica de Alcohol y Drogas",
                    detalle: "Existe una pol칤tica clara sobre consumo de alcohol y drogas, con procedimientos de verificaci칩n y cumplimiento establecidos."
                },
                {
                    tema: "Problemas de Vista - Examinaci칩n de la vista",
                    detalle: "Todos los empleados que realizan viajes por carretera relacionados con el trabajo, incluidos los conductores de la Flota Gris, reciben pruebas de visi칩n al menos una vez cada 2 a침os, con una auditor칤a de seguimiento."
                },
                {
                    tema: "Gesti칩n de la Velocidad - Exceso de velocidad",
                    detalle: "Existe una pol칤tica formal sobre la conducci칩n dentro de los l칤mites de velocidad y a una velocidad adecuada para las condiciones prevalecientes de la carretera (p. ej. en condiciones clim치ticas adversas), con una auditor칤a de seguimiento que cubre a todos los empleados, incluidos los conductores de la Flota Gris."
                },
                {
                    tema: "Gesti칩n de Pol칤tica - Revisiones y actualizaciones",
                    detalle: "Las pol칤ticas se revisan y actualizan anualmente para tener en cuenta los cambios en las pr치cticas operativas, la gesti칩n de la seguridad vial, los cambios en la legislaci칩n y las iniciativas de mejora continua."
                },
                {
                    tema: "Gesti칩n de la Flota Gris - Objetivo",
                    detalle: "O hay empleados que NUNCA viajan en veh칤culos que no sean propiedad o est칠n administrados por la empresa o TODOS los empleados que VIAJEN por carretera por objetivos de trabajo est치n sujetos a la pol칤tica."
                },
                {
                    tema: "Revisi칩n - Auditor칤a de seguimiento",
                    detalle: "Existe una auditor칤a de seguimiento para TODAS las pol칤ticas para demostrar que se est치n siguiendo y que son efectivas."
                }
            ],
            "Evaluar": [
                {
                    tema: "Evaluaci칩n de riesgos - Para todos los conductores",
                    detalle: "Se eval칰an los riesgos para todos los conductores que conduzcan alguna vez por motivos de trabajo, incluyendo a los conductores de flota gris."
                },
                {
                    tema: "Verificaciones del Permiso de Conducir - Todos los permisos",
                    detalle: "Se verifican los permisos de conducir de todos los conductores, incluidos los conductores de veh칤culos de la Flota Gris, para asegurarse de que est치n en vigor y son v치lidos mientras se conduce el veh칤culo."
                }
            ],
            "Control": [
                {
                    tema: "Intervenciones del Conductor - 쯈u칠 intervenciones existen?",
                    detalle: "Una combinaci칩n de: en el veh칤culo, en el aula y en l칤nea, en funci칩n de la necesidad identificada por los datos de evaluaci칩n (evaluaciones de riesgos, informes de colisi칩n, datos de telemetr칤a de comportamiento del conductor y verificaciones de permisos conducir)."
                }
            ],
            "Medida": [
                {
                    tema: "Gesti칩n de accidentes - Costes directos",
                    detalle: "Todos los interesados conocen y entienden todos los costes de seguro, y cualquier coste por debajo del deducible (por debajo del exceso de seguro) asociados con incidentes de conducci칩n. Esto ayuda a garantizar que todos entiendan las implicaciones completas para el negocio de un accidente."
                },
                {
                    tema: "Indicadores Clave de Rendimiento - Indicadores rezagados",
                    detalle: "Los indicadores rezagados, incluidos los accidentes por mill칩n de millas (CPMM), los costes de accidentes, el coste de mantenimiento y la cantidad de infracciones de conducci칩n, son conocidos por todos los conductores, incluidos los empleados que conducen veh칤culos de la Flota Gris, se registran mensualmente y son conocidos y entendidos por todos los interesados."
                },
                {
                    tema: "Informes de Accidentes - Informe del conductor",
                    detalle: "El conductor registra los datos completos, incluyendo fotograf칤as, para cada incidente e informa a las aseguradoras inmediatamente y al Superiores Inmediato en 24 horas."
                },
                {
                    tema: "Informes de Accidentes - Fichas de accidentes",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh칤culos de la Flota Gris, tienen una ficha de accidentes completa o equivalente, que cubre todos los detalles que ser치n 칰tiles en el an치lisis posterior de la causa ra칤z, as칤 como lo requieren las aseguradoras, para permitir que todos los detalles del incidente se registren de forma sistem치tica. Hay evidencia de que estas se completan en su totalidad despu칠s de cada incidente."
                },
                {
                    tema: "Informes de Gesti칩n - Visibilidad para la alta gerencia",
                    detalle: "Todos los Indicadores Clave de Rendimiento del programa de gesti칩n de riesgos viales relacionados con el trabajo se distribuyen a todos los gerentes principales al menos mensualmente."
                }
            ],
            "Conductor": [
                {
                    tema: "Manual del Conductor - Manuales suministrados",
                    detalle: "Se proporcionan manuales para conductores a TODOS los empleados que realizan viajes por carretera relacionados con el trabajo, incluidos los empleados que conducen veh칤culos de la Flota Gris, que incluyen todos los elementos clave de pol칤ticas y procedimientos junto con consejos de conducci칩n segura. El manual debe ayudar a los empleados a cumplir con sus pol칤ticas y procedimientos de conducci칩n segura."
                },
                {
                    tema: "Manual del Conductor - Revisi칩n y actualizaci칩n",
                    detalle: "Los manuales se revisan anualmente y/o cada vez que se realizan cambios significativos en las pol칤ticas y procedimientos o consejos de seguridad de conducci칩n y se actualizan en consecuencia."
                },
                {
                    tema: "Responsabilidades del Conductor - Condiciones para conducir",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh칤culos de la Flota Gris, se aseguran de que est칠n en condiciones de conducir antes de realizar CUALQUIER viaje por carretera relacionado con el trabajo. Esto incluye cuestiones relacionadas con la salud, la vista, la discapacidad y la fatiga."
                },
                {
                    tema: "Responsabilidades del Conductor - Cumplimiento legislativo",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh칤culos de la Flota Gris, cumplen plenamente con toda la legislaci칩n local. Hay una auditor칤a de seguimiento que demuestra que la mayor칤a de los conductores cumplen con esta obligaci칩n (p. ej. por multas por exceso de velocidad)."
                },
                {
                    tema: "Responsabilidades del Conductor - Notificaci칩n de cambios",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh칤culos de la Flota Gris, est치n totalmente obligados a notificar a su Superior Inmediato sobre cualquier cambio en las circunstancias que podr칤an cambiar los riesgos que enfrentan. Esto incluye problemas de salud, cambios de direcci칩n y cambios en los permisos de conducir."
                },
                {
                    tema: "Responsabilidades del Conductor - Legalidad del veh칤culo",
                    detalle: "Todos los conductores, incluidos los empleados que conducen veh칤culos de la Flota Gris, son plenamente conscientes de su obligaci칩n de garantizar que el veh칤culo que utilizan para viajes por carretera relacionados con el trabajo, independientemente de su propiedad, sea completamente legal y cumpla con los requisitos m칤nimos de seguridad de la empresa. Existen pruebas de que esta obligaci칩n generalmente se cumple (p. ej. de los registros de mantenimiento, como los veh칤culos que tienen uno o m치s neum치ticos defectuosos)."
                }
            ],
            "Viaje": [
                {
                    tema: "Evaluaci칩n de la necesidad de viajar - Los viajes innecesarios son eliminados",
                    detalle: "Los viajes se eliminan siempre que sea posible, a trav칠s de cambios en las pr치cticas operativas (p. ej. mediante el uso de videoconferencia para reemplazar la necesidad de viajar en algunos casos)."
                },
                {
                    tema: "Condiciones Clim치ticas Adversas - Conducci칩n en climas extremos",
                    detalle: "No se realizan viajes en condiciones clim치ticas extremas, donde las autoridades han aconsejado no viajar o donde su evaluaci칩n din치mica de riesgos muestra que existen riesgos inaceptables."
                }
            ],
            "Veh칤culo": [
                {
                    tema: "Selecci칩n del Veh칤culo - Los veh칤culos se adecuan al prop칩sito",
                    detalle: "Todos los veh칤culos, incluidos los veh칤culos de la Flota Gris, son adecuados para los viajes requeridos (adecuados para el prop칩sito). Esto incluye problemas ergon칩micos en torno a las posiciones de los asientos, lo que se transporta en el veh칤culo y la carga/descarga."
                },
                {
                    tema: "Selecci칩n del Veh칤culo - Especificaci칩n de seguridad m칤nima",
                    detalle: "Todos los veh칤culos est치n equipados con cinturones de seguridad para todos los asientos, 2 espejos retrovisores, 2 airbags y Control Electr칩nico de Estabilidad como m칤nimo. Si su especificaci칩n de seguridad m칤nima es m치s avanzada, entonces deber칤a usarse como estos criterios."
                },
                {
                    tema: "Mantenimiento del Veh칤culo - Mantenimiento de rutina",
                    detalle: "Todos los conductores revisan sus veh칤culos al menos una vez por semana, con evidencia como soporte. Para furgonetas y camiones, estos controles se llevan a cabo diariamente. Existe una auditor칤a de seguimiento para apoyar esto."
                },
                {
                    tema: "Mantenimiento del Veh칤culo - Reparaci칩n",
                    detalle: "Todos los veh칤culos, incluidos los veh칤culos de la Flota Gris, son verificados seg칰n los programas del fabricante y/o intervalos variables, por talleres OEM [Original Equipment Manufacturer (Fabricante de Equipo Original)]. Existe una auditor칤a de seguimiento para apoyar esto."
                }
            ]
        };

        let responses = {};
        let totalQuestions = 0;

        function initializeEvaluation() {
            const container = document.getElementById('evaluationSections');
            let questionId = 0;

            Object.keys(evaluationData).forEach((category, categoryIndex) => {
                const section = document.createElement('div');
                section.className = 'bg-white rounded-lg shadow-lg fade-in';
                
                let sectionHTML = `
                    <div class="p-6 border-b border-gray-200">
                        <button onclick="toggleSection('${category}')" class="w-full flex items-center justify-between text-left">
                            <h2 class="text-2xl font-bold text-indigo-900">
                                ${category} (${evaluationData[category].length} preguntas)
                            </h2>
                            <svg id="icon-${category}" class="w-6 h-6 text-indigo-600 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="content-${category}" class="p-6 ${categoryIndex === 0 ? '' : 'hidden'}">
                `;

                evaluationData[category].forEach(item => {
                    const id = `q${questionId}`;
                    totalQuestions++;
                    
                    sectionHTML += `
                        <div class="mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                            <h3 class="font-semibold text-lg text-gray-800 mb-3">${item.tema}</h3>
                            <p class="text-sm text-gray-600 mb-4 leading-relaxed">${item.detalle}</p>
                            
                            <div class="space-y-2">
                                <label class="flex items-center p-3 bg-white rounded-lg border-2 border-gray-200 cursor-pointer hover:border-green-400 transition duration-200">
                                    <input type="radio" name="${id}" value="1" onchange="updateResponse('${id}', 1, '${category}')" class="w-5 h-5 text-green-600">
                                    <span class="ml-3 text-gray-700">
                                        <strong class="text-green-600">Alto (1 punto)</strong> - Todo est치 en su lugar
                                    </span>
                                </label>
                                
                                <label class="flex items-center p-3 bg-white rounded-lg border-2 border-gray-200 cursor-pointer hover:border-yellow-400 transition duration-200">
                                    <input type="radio" name="${id}" value="0.5" onchange="updateResponse('${id}', 0.5, '${category}')" class="w-5 h-5 text-yellow-600">
                                    <span class="ml-3 text-gray-700">
                                        <strong class="text-yellow-600">Intermedio (0.5 puntos)</strong> - Parte est치 en su lugar
                                    </span>
                                </label>
                                
                                <label class="flex items-center p-3 bg-white rounded-lg border-2 border-gray-200 cursor-pointer hover:border-red-400 transition duration-200">
                                    <input type="radio" name="${id}" value="0" onchange="updateResponse('${id}', 0, '${category}')" class="w-5 h-5 text-red-600">
                                    <span class="ml-3 text-gray-700">
                                        <strong class="text-red-600">Bajo (0 puntos)</strong> - Poco o nada est치 en su lugar
                                    </span>
                                </label>
                            </div>
                        </div>
                    `;
                    
                    questionId++;
                });

                sectionHTML += '</div>';
                section.innerHTML = sectionHTML;
                container.appendChild(section);
            });

            document.getElementById('evaluationDate').valueAsDate = new Date();
        }

        function toggleSection(category) {
            const content = document.getElementById(`content-${category}`);
            const icon = document.getElementById(`icon-${category}`);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function updateResponse(questionId, score, category) {
            responses[questionId] = { score, category };
            updateProgress();
            checkCompletion();
        }

        function updateProgress() {
            const answered = Object.keys(responses).length;
            const percentage = Math.round((answered / totalQuestions) * 100);
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';
        }

        function checkCompletion() {
            if (Object.keys(responses).length === totalQuestions) {
                calculateResults();
            }
        }

        function calculateResults() {
            let totalScore = 0;
            const categoryScores = {};

            Object.values(responses).forEach(response => {
                totalScore += response.score;
                
                if (!categoryScores[response.category]) {
                    categoryScores[response.category] = { score: 0, count: 0 };
                }
                categoryScores[response.category].score += response.score;
                categoryScores[response.category].count += 1;
            });

            const percentage = (totalScore / totalQuestions) * 100;
            let classification, classColor;

            if (percentage >= 75) {
                classification = "Buena";
                classColor = "from-green-500 to-green-600";
            } else if (percentage >= 25) {
                classification = "Intermedia";
                classColor = "from-yellow-500 to-yellow-600";
            } else {
                classification = "Baja";
                classColor = "from-red-500 to-red-600";
            }

            // Calculate rating out of 10
            const ratingOutOf10 = (percentage / 100) * 10;
            
            // Update all display elements
            document.getElementById('maxScore').textContent = totalQuestions;
            document.getElementById('obtainedScore').textContent = totalScore.toFixed(1);
            document.getElementById('ratingOutOf10').textContent = ratingOutOf10.toFixed(1);
            document.getElementById('totalScore').textContent = totalScore.toFixed(1);
            document.getElementById('totalPossible').textContent = `de ${totalQuestions} puntos`;
            document.getElementById('percentageScore').textContent = percentage.toFixed(1) + '%';
            document.getElementById('ratingDisplay').textContent = ratingOutOf10.toFixed(1) + '/10';
            document.getElementById('classification').textContent = classification;
            document.getElementById('classificationBox').className = `rounded-lg p-6 text-white bg-gradient-to-br ${classColor}`;

            const categoryResultsHTML = Object.keys(categoryScores).map(category => {
                const catScore = categoryScores[category].score;
                const catMax = categoryScores[category].count;
                const catPercentage = (catScore / catMax) * 100;
                
                return `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-gray-800">${category}</h4>
                            <span class="text-sm font-medium text-indigo-600">${catScore.toFixed(1)} / ${catMax}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: ${catPercentage}%"></div>
                        </div>
                        <p class="text-xs text-gray-600 mt-1">${catPercentage.toFixed(1)}%</p>
                    </div>
                `;
            }).join('');

            document.getElementById('categoryResults').innerHTML = categoryResultsHTML;
            createRadarChart(categoryScores);
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateReport() {
            const companyName = document.getElementById('companyName').value || 'Sin especificar';
            const evaluationDate = document.getElementById('evaluationDate').value || new Date().toISOString().split('T')[0];
            
            let totalScore = 0;
            Object.values(responses).forEach(response => {
                totalScore += response.score;
            });
            const percentage = (totalScore / totalQuestions) * 100;
            
            let classification;
            if (percentage >= 75) classification = "Buena";
            else if (percentage >= 25) classification = "Intermedia";
            else classification = "Baja";

            let reportContent = `REPORTE DE AUTOEVALUACI칍N DE GESTI칍N DE RIESGOS VIALES\n`;
            reportContent += `Road Risk Toolkit GRSF\n`;
            reportContent += `${'='.repeat(60)}\n\n`;
            reportContent += `Empresa: ${companyName}\n`;
            reportContent += `Fecha de Evaluaci칩n: ${evaluationDate}\n\n`;
            reportContent += `RESULTADOS GENERALES\n`;
            reportContent += `${'-'.repeat(60)}\n`;
            reportContent += `Puntuaci칩n Total: ${totalScore.toFixed(1)} de ${totalQuestions} puntos\n`;
            reportContent += `Porcentaje: ${percentage.toFixed(1)}%\n`;
            reportContent += `Clasificaci칩n: ${classification}\n\n`;
            
            reportContent += `DETALLES POR CATEGOR칈A\n`;
            reportContent += `${'-'.repeat(60)}\n\n`;

            const categoryScores = {};
            Object.values(responses).forEach(response => {
                if (!categoryScores[response.category]) {
                    categoryScores[response.category] = { score: 0, count: 0 };
                }
                categoryScores[response.category].score += response.score;
                categoryScores[response.category].count += 1;
            });

            Object.keys(categoryScores).forEach(category => {
                const catScore = categoryScores[category].score;
                const catMax = categoryScores[category].count;
                const catPercentage = (catScore / catMax) * 100;
                reportContent += `${category}:\n`;
                reportContent += `  Puntuaci칩n: ${catScore.toFixed(1)} / ${catMax}\n`;
                reportContent += `  Porcentaje: ${catPercentage.toFixed(1)}%\n\n`;
            });

            reportContent += `\n${'='.repeat(60)}\n`;
            reportContent += `Generado por Road Risk Toolkit - Autoevaluaci칩n\n`;
            reportContent += `Para m치s informaci칩n: https://roadrisktoolkit.com/\n`;

            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Reporte_Evaluacion_${companyName.replace(/\s+/g, '_')}_${evaluationDate}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function createRadarChart(categoryScores) {
            const svg = document.getElementById('radarChart');
            svg.innerHTML = '';
            
            const centerX = 175;
            const centerY = 175;
            const maxRadius = 130;
            const categories = Object.keys(categoryScores);
            const numCategories = categories.length;
            
            // Create background circles with labels
            for (let i = 1; i <= 5; i++) {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', centerX);
                circle.setAttribute('cy', centerY);
                circle.setAttribute('r', (maxRadius * i) / 5);
                circle.setAttribute('fill', 'none');
                circle.setAttribute('stroke', i === 5 ? '#9ca3af' : '#e5e7eb');
                circle.setAttribute('stroke-width', i === 5 ? '2' : '1');
                svg.appendChild(circle);
                
                // Add percentage labels
                if (i === 5) {
                    const percentages = [20, 40, 60, 80, 100];
                    percentages.forEach((perc, idx) => {
                        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        text.setAttribute('x', centerX + 5);
                        text.setAttribute('y', centerY - (maxRadius * (idx + 1)) / 5 + 4);
                        text.setAttribute('font-size', '10');
                        text.setAttribute('fill', '#6b7280');
                        text.textContent = perc + '%';
                        svg.appendChild(text);
                    });
                }
            }
            
            // Create axis lines and labels
            categories.forEach((category, index) => {
                const angle = (index * 2 * Math.PI) / numCategories - Math.PI / 2;
                const x = centerX + Math.cos(angle) * maxRadius;
                const y = centerY + Math.sin(angle) * maxRadius;
                
                // Axis line
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', centerX);
                line.setAttribute('y1', centerY);
                line.setAttribute('x2', x);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#9ca3af');
                line.setAttribute('stroke-width', '2');
                svg.appendChild(line);
                
                // Label with better positioning
                const labelDistance = maxRadius + 35;
                const labelX = centerX + Math.cos(angle) * labelDistance;
                const labelY = centerY + Math.sin(angle) * labelDistance;
                
                // Create text with line breaks for long category names
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', labelX);
                text.setAttribute('y', labelY);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('font-size', '11');
                text.setAttribute('font-weight', 'bold');
                text.setAttribute('fill', '#1f2937');
                
                // Split long category names
                const words = category.split(' ');
                if (words.length > 2) {
                    const tspan1 = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                    tspan1.setAttribute('x', labelX);
                    tspan1.setAttribute('dy', '-6');
                    tspan1.textContent = words.slice(0, 2).join(' ');
                    text.appendChild(tspan1);
                    
                    const tspan2 = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                    tspan2.setAttribute('x', labelX);
                    tspan2.setAttribute('dy', '12');
                    tspan2.textContent = words.slice(2).join(' ');
                    text.appendChild(tspan2);
                } else {
                    text.textContent = category;
                }
                
                svg.appendChild(text);
            });
            
            // Create data polygon
            let pathData = '';
            const dataPoints = [];
            
            categories.forEach((category, index) => {
                const score = categoryScores[category].score;
                const maxScore = categoryScores[category].count;
                const percentage = (score / maxScore) * 100;
                const radius = (maxRadius * percentage) / 100;
                
                const angle = (index * 2 * Math.PI) / numCategories - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                dataPoints.push({ x, y, percentage: percentage.toFixed(1), category });
                
                if (index === 0) {
                    pathData += `M ${x} ${y}`;
                } else {
                    pathData += ` L ${x} ${y}`;
                }
            });
            
            pathData += ' Z';
            
            // Add filled polygon
            const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            polygon.setAttribute('d', pathData);
            polygon.setAttribute('fill', 'rgba(79, 70, 229, 0.3)');
            polygon.setAttribute('stroke', '#4f46e5');
            polygon.setAttribute('stroke-width', '3');
            svg.appendChild(polygon);
            
            // Add data points with values
            dataPoints.forEach(point => {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', point.x);
                circle.setAttribute('cy', point.y);
                circle.setAttribute('r', '5');
                circle.setAttribute('fill', '#4f46e5');
                circle.setAttribute('stroke', 'white');
                circle.setAttribute('stroke-width', '2');
                svg.appendChild(circle);
                
                // Add percentage value near the point
                const valueText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                valueText.setAttribute('x', point.x);
                valueText.setAttribute('y', point.y - 10);
                valueText.setAttribute('text-anchor', 'middle');
                valueText.setAttribute('font-size', '10');
                valueText.setAttribute('font-weight', 'bold');
                valueText.setAttribute('fill', '#1f2937');
                valueText.setAttribute('background', 'white');
                valueText.textContent = point.percentage + '%';
                svg.appendChild(valueText);
            });
        }

        function resetEvaluation() {
            responses = {};
            document.getElementById('companyName').value = '';
            document.getElementById('evaluationDate').valueAsDate = new Date();
            
            const radios = document.querySelectorAll('input[type="radio"]');
            radios.forEach(radio => radio.checked = false);
            
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
            document.getElementById('resultsSection').classList.add('hidden');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        initializeEvaluation();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9966582d57eeb6ec',t:'MTc2MTc3OTQwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
